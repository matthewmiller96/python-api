name: Deploy to My Server

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: self-hosted  # Changed from ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Deploy locally
      run: |
        # Deploy directly on the local network
        cd ~/myapp || mkdir -p ~/myapp && cd ~/myapp
        
        # Copy files
        rsync -av --exclude='.git' --exclude='.github' --exclude='.venv' --exclude='__pycache__' ${{ github.workspace }}/ ./
        
        # Deploy with Docker
        docker compose down || true
        docker compose up -d --build